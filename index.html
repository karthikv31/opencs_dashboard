<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open CS – Super Computer Curriculum</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#0f172a; --muted:#6b7280; --accent:#2563eb;
      --ring:#e5e7eb; --shadow:0 10px 20px rgba(0,0,0,.06);
      --c1:#2563eb; --c2:#f59e0b; --c3:#10b981; --c4:#ef4444; --c5:#8b5cf6; --c6:#14b8a6; --c7:#e11d48; --c8:#f97316; --c9:#0ea5e9;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--ink)}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{font-size:clamp(20px,4vw,28px);font-weight:800}
    .btn{appearance:none;border:0;border-radius:12px;background:#111;color:#fff;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn.light{background:#fff;color:var(--ink);border:1px solid var(--ring)}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:20px;box-shadow:var(--shadow);padding:20px}
    .center{display:flex;flex-direction:column;align-items:center}
    .badge{width:170px;height:170px;border-radius:999px;background:radial-gradient(120px 120px at 35% 30%, #60a5fa, #2563eb);display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 12px 32px rgba(37,99,235,.35);text-align:center}
    .badge h2{margin:0;font-size:22px;letter-spacing:.2px}
    .badge small{display:block;opacity:.9;font-weight:600;letter-spacing:.06em}
    .openBtn{margin-top:14px}
    .grid{display:grid;gap:12px}
    .grid.series{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));}
    .grid.grades{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));}
    .tile{border:1px solid var(--ring);border-radius:16px;padding:14px 12px;background:#fff;cursor:pointer;font-weight:700;text-align:center;transition:transform .08s ease, box-shadow .12s ease}
    .tile:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.08)}
    .crumbs{color:var(--muted);font-size:14px;margin:8px 0 16px}
    .crumbs button{all:unset;cursor:pointer;color:var(--muted)}
    .crumbs button:hover{text-decoration:underline}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .search{flex:1;min-width:220px;border:1px solid var(--ring);border-radius:12px;padding:10px 12px}
    .chapter{border:1px solid var(--ring);border-radius:14px;padding:12px;background:#f9fafb}
    .muted{color:var(--muted)}
    .stats{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-top:14px}
    .stat{background:#fff;border:1px solid var(--ring);border-radius:16px;padding:14px;text-align:center}
    .stat .k{font-size:22px;font-weight:800}
    @media (max-width:740px){.stats{grid-template-columns:repeat(2,minmax(0,1fr));}}

    /* Ring layout styling */
    .ring{position:relative; width:min(640px,90vw); height:min(640px,90vw); margin:12px auto 0;}
    .ring .centerBadge{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);} 
    .node{position:absolute; width:140px; height:140px; display:flex; align-items:center; justify-content:center; text-align:center; cursor:pointer; 
      color:#fff; font-weight:800; filter:drop-shadow(0 10px 14px rgba(0,0,0,.12)); transition:transform .15s ease, box-shadow .15s ease, opacity .2s}
    .node:hover{transform:translateY(-3px) scale(1.03)}
    .label{padding:10px}
    /* shapes using clip-path */
    .shape-circle{clip-path:circle(50% at 50% 50%);} 
    .shape-hex{clip-path:polygon(25% 6%,75% 6%,100% 50%,75% 94%,25% 94%,0 50%);} 
    .shape-diamond{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%);} 
    .shape-pill{border-radius:28px;} 
    .shape-sq{border-radius:18px;} 
    /* color helpers */
    .c1{background:var(--c1)} .c2{background:var(--c2)} .c3{background:var(--c3)} .c4{background:var(--c4)} .c5{background:var(--c5)} .c6{background:var(--c6)} .c7{background:var(--c7)} .c8{background:var(--c8)} .c9{background:var(--c9)}
    /* toggle pills */
    .viewToggle{display:inline-flex; gap:6px; background:#fff; border:1px solid var(--ring); border-radius:999px; padding:4px;}
    .viewToggle button{border:0; background:transparent; padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600; color:var(--muted)}
    .viewToggle button.active{background:#111; color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">Open CS Dashboard</div>
      <div class="actions">
        <div class="viewToggle" id="viewToggle">
          <button data-view="ring" class="active">Ring</button>
          <button data-view="grid">Grid</button>
        </div>
        <button class="btn light" id="importBtn">Import JSON</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="card">
      <div class="center">
        <div class="badge">
          <div>
            <small>Super Computer Curriculum</small>
            <h2>OPEN CS</h2>
          </div>
        </div>
        <button class="btn openBtn" id="openBtn">Open</button>
      </div>

      <div class="crumbs" id="crumbs" hidden></div>
      <div class="muted" id="sourceBadge" style="font-size:12px; margin:-6px 0 8px 0;">Data source: <b>Embedded demo</b> (use Import JSON or auto-load)</div>

      <div id="content" style="margin-top:12px"></div>
    </div>

    <div class="stats">
      <div class="stat"><div class="muted">Total Series</div><div class="k" id="kSeries">-</div></div>
      <div class="stat"><div class="muted">Total Grades</div><div class="k" id="kGrades">-</div></div>
      <div class="stat"><div class="muted">Total Chapters</div><div class="k" id="kChapters">-</div></div>
      <div class="stat"><div class="muted">Selected</div><div class="k" id="kSelected">Curriculum</div></div>
    </div>
  </div>

<script>
// ===== Fallback demo data (will be replaced when JSON loads) =====
let data = {
  "FunCoder 3.0": {
    1: ["Unboxing Computer","Click, Click, Click!","Touch to Type"],
    2: ["Paint without Paint","Let's Sequence"],
    3: ["Code Games – Intro","Mouse Maestro"]
  },
  "HappyCoder3.0": {
    1: ["Meet My Computer","Parts of a Computer","Do's and Don'ts"],
    2: ["Files & Folders","Tux Paint Master"],
    3: ["Animated Stories","Interactive Story Game","Mail Merge Basics"]
  },
  "SuperCoder 3.0": { 4:["Algorithms & Flowcharts","Loops Adventure"], 5:["Scratch Games","Broadcast & Events"] },
  "SmartCoder 3.0": { 6:["Spreadsheets Power","VLOOKUP Quest"], 7:["Microcontrollers","Breadboard Basics"], 8:["Tinkercad Circuits","Sensors & Actuators"] },
  "MasterCoder3.0": { 6:["Python Basics","If/Else Missions"], 7:["Functions & Lists","File I/O"], 8:["APIs & JSON","Mini Projects"] },
  "FutureCoder 3.0": { 7:["AI Concepts","Ethics & Bias"], 8:["ML Teasers","Vision & Speech"] },
  "CreativeCoder 3.0": { 3:["Poster Design","Photo Editing"], 4:["Vector Shapes","Color Theory"] },
  "AI SuperStar": { 7:["Chatbots 101","Prompt Basics"], 8:["Vision Demos","Text to App"] },
  "IT SuperStar": { 8:["Networking Basics","Cyber Safety"] }
};

// ===== State =====
let level = 'root';
let currentSeries = null;
let currentGrade = null;
let searchTerm = '';
window.seriesView = new URLSearchParams(location.search).get('view') === 'grid' ? 'grid' : 'ring';

const el = (sel)=>document.querySelector(sel);
const content = el('#content');
const crumbs = el('#crumbs');

// --- helpers ---
function getChapters(series, grade){
  const obj = data[series] || {};
  return obj[grade] || obj[String(grade)] || obj[Number(grade)] || [];
}
function sumChaptersOfSeries(series){
  const obj = data[series] || {};
  return Object.values(obj).reduce((a,chs)=> a + (Array.isArray(chs)? chs.length : 0), 0);
}

function reset(){ level='root'; currentSeries=null; currentGrade=null; searchTerm=''; render(); }

function setStats(){
  const allSeries = Object.keys(data);
  const totalsAllGrades = allSeries.reduce((acc,s)=> acc + Object.keys(data[s]||{}).length, 0);
  const totalsAllChapters = allSeries.reduce((acc,s)=> acc + sumChaptersOfSeries(s), 0);

  let sCount = allSeries.length;
  let gCount = totalsAllGrades;
  let cCount = totalsAllChapters;
  let selected = 'Curriculum';

  if(level === 'series'){
    selected = 'Series';
  }
  if(level === 'grade' && currentSeries){
    sCount = 1;
    const gradesObj = data[currentSeries] || {};
    gCount = Object.keys(gradesObj).length;
    cCount = Object.values(gradesObj).reduce((a,chs)=> a + (Array.isArray(chs)? chs.length : 0), 0);
    selected = currentSeries;
  }
  if(level === 'chapters' && currentSeries && (currentGrade!==null)){
    sCount = 1;
    gCount = 1;
    cCount = getChapters(currentSeries, currentGrade).length;
    selected = `${currentSeries} — G${currentGrade}`;
  }

  el('#kSeries').textContent = sCount;
  el('#kGrades').textContent = gCount;
  el('#kChapters').textContent = cCount;
  el('#kSelected').textContent = selected;
}

function renderCrumbs(){
  if(level==='root'){ crumbs.hidden = true; return; }
  crumbs.hidden = false;
  const parts = [
    `<button data-act="home">Super Computer Curriculum</button>`
  ];
  if(currentSeries){ parts.push(`<span>›</span> <button data-act="series">${currentSeries}</button>`); }
  if(currentGrade){ parts.push(`<span>›</span> <span>Grade ${currentGrade}</span>`); }
  crumbs.innerHTML = parts.join(' ');
  crumbs.onclick = (e)=>{
    const act = e.target.getAttribute('data-act');
    if(!act) return;
    if(act==='home') reset();
    if(act==='series'){ level='grade'; currentGrade=null; render(); }
  };
}

function renderRoot(){
  content.innerHTML = `<div class="muted" style="text-align:center;padding:24px">Click <b>Open</b> to view all series.</div>`;
}

function renderSeries(){
  const series = Object.keys(data);
  if(window.seriesView === 'grid'){
    content.innerHTML = `<div class="grid series">${series.map((s)=>`<div class=\"tile\" data-series=\"${s}\">${s}</div>`).join('')}</div>`;
  } else {
    const shapes = ['shape-circle','shape-hex','shape-diamond','shape-pill','shape-sq'];
    const html = [
      '<div class="ring">',
      '  <div class="centerBadge">',
      '    <div class="badge"><div><small>Super Computer Curriculum</small><h2>OPEN CS</h2></div></div>',
      '  </div>'
    ];
    const n = series.length; const R = 45; // radius percent from center
    series.forEach((name, idx)=>{
      const angle = (idx / n) * 2 * Math.PI - Math.PI/2; // start at top
      const x = 50 + (R * Math.cos(angle));
      const y = 50 + (R * Math.sin(angle));
      const colorClass = `c${(idx%9)+1}`;
      const shapeClass = shapes[idx % shapes.length];
      html.push(`<div class=\"node ${shapeClass} ${colorClass}\" style=\"left:${x}%; top:${y}%; transform:translate(-50%,-50%);\" data-series=\"${name}\"><div class=\"label\">${name}</div></div>`);
    });
    html.push('</div>');
    content.innerHTML = html.join('');
  }
  // one handler supports both ring and grid (looks for [data-series])
  content.onclick = (e)=>{
    const elTile = e.target.closest('[data-series]');
    if(!elTile) return;
    const s = elTile.getAttribute('data-series');
    currentSeries = s; level='grade'; render();
  };
}

function renderGrades(){
  const grades = Object.keys(data[currentSeries]).map(n=>Number(n)).sort((a,b)=>a-b);
  content.innerHTML = `<div class="grid grades">${grades.map(g=>`<div class=\"tile\" data-grade=\"${g}\">Grade ${g}</div>`).join('')}</div>`;
  content.onclick = (e)=>{
    const elG = e.target.closest('[data-grade]');
    if(!elG) return;
    currentGrade = Number(elG.getAttribute('data-grade'));
    level='chapters'; render();
  };
}

function renderChapters(){
  const listAll = getChapters(currentSeries, currentGrade);
  const list = searchTerm ? listAll.filter(c=>c.toLowerCase().includes(searchTerm.toLowerCase())) : listAll;
  const head = `<div class="row">
      <div style="font-weight:800;font-size:18px">${currentSeries} — Grade ${currentGrade}</div>
      <input class="search" id="search" placeholder="Search chapters..." value="${searchTerm}">
      <button class="btn" id="back">Back to Grades</button>
    </div>`;
  const grid = list.length
    ? `<div class="grid series">${list.map((c,i)=>`<div class=\"chapter\"><div class=\"muted\">Chapter ${i+1}</div><div style=\"font-weight:700\">${c}</div></div>`).join('')}</div>`
    : `<div class="muted">No chapters found.</div>`;
  content.innerHTML = head + grid;
  el('#back').onclick = ()=>{ level='grade'; render(); };
  el('#search').oninput = (e)=>{ searchTerm = e.target.value; renderChapters(); };
}

function render(){
  setStats();
  renderCrumbs();
  if(level==='root') return renderRoot();
  if(level==='series') return renderSeries();
  if(level==='grade') return renderGrades();
  if(level==='chapters') return renderChapters();
}

// ===== Buttons =====
el('#openBtn').onclick = ()=>{ level='series'; render(); };
el('#resetBtn').onclick = reset;
// view toggle
el('#viewToggle').onclick = (e)=>{
  const btn = e.target.closest('button'); if(!btn) return;
  window.seriesView = btn.getAttribute('data-view');
  el('#viewToggle').querySelectorAll('button').forEach(b=>b.classList.toggle('active', b===btn));
  if(level==='series') renderSeries();
};

// ===== Import JSON (structure: { "Series": { "1": ["Chapter 1", ...] } }) =====
el('#importBtn').onclick = async ()=>{
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'application/json';
  input.onchange = async ()=>{
    const file = input.files[0];
    if(!file) return;
    const text = await file.text();
    try {
      const json = JSON.parse(text);
      if(typeof json === 'object' && !Array.isArray(json)){
        data = json; el('#sourceBadge').innerHTML = 'Data source: <b>Imported JSON ('+ (file.name||'local') +')</b>'; reset();
      } else {
        alert('Invalid JSON shape. Expect an object: { "Series": { "1": ["Chapter" ] } }');
      }
    } catch(err){ alert('Invalid JSON: ' + err.message); }
  };
  input.click();
};

// ===== Auto-load opencs_series_grades_chapters.json if present next to index.html =====
(async function autoLoad(){
  try{
    const res = await fetch('opencs_series_grades_chapters.json', { cache: 'no-store' });
    if(res.ok){
      const json = await res.json();
      if(json && typeof json === 'object'){
        data = json; el('#sourceBadge').innerHTML = 'Data source: <b>opencs_series_grades_chapters.json</b>'; reset();
      }
    }
  }catch(e){ /* ignore if file missing or file:// */ }
})();

// ===== Minimal self-tests (console) =====
(function runSelfTests(){
  try{
    console.group('%cOpenCS Dashboard – Self Test','color:#2563eb;font-weight:700');
    console.assert(typeof data === 'object', 'data should be an object');
    const sKeys = Object.keys(data);
    console.assert(sKeys.length > 0, 'should have at least one series');
    const firstS = sKeys[0];
    const gKeys = Object.keys(data[firstS] || {});
    console.assert(gKeys.length > 0, 'selected series should have at least one grade');
    const firstG = gKeys[0];
    console.assert(Array.isArray(getChapters(firstS, firstG)), 'getChapters returns an array');

    // Stats test: grade-level selection shows series-only totals
    level='grade'; currentSeries = firstS; currentGrade = null; setStats();
    const expectedGrades = Object.keys(data[firstS]).length;
    const expectedChaps = sumChaptersOfSeries(firstS);
    console.assert(Number(el('#kGrades').textContent) === expectedGrades, 'grade view: grades count should match series grades');
    console.assert(Number(el('#kChapters').textContent) === expectedChaps, 'grade view: chapters count should match series total chapters');

    // Stats test: chapters-level selection shows grade-only chapters
    level='chapters'; currentGrade = Number(firstG) || firstG; setStats();
    const expectedGradeChaps = getChapters(firstS, currentGrade).length;
    console.assert(Number(el('#kChapters').textContent) === expectedGradeChaps, 'chapters view: chapters count should match selected grade');

    // reset state after tests
    reset();
    console.log('Self-tests passed.');
    console.groupEnd();
  } catch(err){
    console.error('Self-tests failed:', err);
  }
})();

// init
render();
</script>
</body>
</html>
